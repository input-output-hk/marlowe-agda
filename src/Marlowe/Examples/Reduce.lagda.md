---
title: Marlowe.Examples.Reduce
layout: page
---

```
module Marlowe.Examples.Reduce where
```

## Imports

```
open import Data.List using (List; []; _∷_; [_])
open import Data.Product using (Σ; _,_; ∃; Σ-syntax; ∃-syntax)
open import Data.String as String
open import Data.Sum using (inj₁; inj₂)
open import Relation.Binary using (DecidableEquality)
open import Relation.Binary.PropositionalEquality using (_≡_; refl)

open import Contrib.Data.List.AssocList
open import Marlowe.Language.Contract as C 
open import Marlowe.Language.State as S
import Marlowe.Language.Transaction as T
```

### Token and Party

`Token` and `Party` here are just strings.

```
Party = String
_≟-Party_ = String._≟_

Token = String
_≟-Token_ = String._≟_
```

```
open C.Domain _≟-Party_ _≟-Token_
open S.Domain _≟-Party_ _≟-Token_
open T.Domain _≟-Party_ _≟-Token_ 
open import Marlowe.Semantics.Reduce _≟-Party_ _≟-Token_
```

### Examples

The reduction steps of a contract until it is quiescent can be generated by Agda using
`C-c C-n`.

```
accountId₁ accountId₂ : AccountId
accountId₁ = mkAccountId "role₁"
accountId₂ = mkAccountId "role₂"

config₂ : Configuration
config₂ =
  ⟪ If TrueObs Close Close
  , ⟨ [ (accountId₁ , "token" ) , 5 ] , [] , [] , mkPosixTime 0 ⟩
  , mkEnvironment (mkInterval (mkPosixTime 0) 5)
  , []
  , []
  ⟫

config₁ : Configuration
config₁ =
  ⟪ Close
  , ⟨ [ ( accountId₁ , "token" ) , 5 ] , [] , [] , mkPosixTime 0 ⟩
  , mkEnvironment (mkInterval (mkPosixTime 0) 5)
  , []
  , []
  ⟫

config₀ : Configuration
config₀ =
  ⟪ Close
  , ⟨ [] , [] , [] , mkPosixTime 0 ⟩
  , mkEnvironment (mkInterval (mkPosixTime 0) 5)
  , []
  , [ accountId₁ [ "token" , 5 ]↦ mkParty (unAccountId accountId₁) ]
  ⟫

_ = ⇀-eval config₂
    ≡ ( config₀
      , (config₂ ⇀⟨ IfTrue refl ⟩ config₁ ⇀⟨ CloseRefund ⟩ config₀ ∎)
      , inj₁ close
      )

```
